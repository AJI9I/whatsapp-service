<!DOCTYPE html>
<html lang="ru" dir="ltr" data-nav-layout="vertical" data-theme-mode="light" data-header-styles="light" data-menu-styles="light" data-toggled="open">

<head>
    <!-- Meta Data -->
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>–õ–æ–≥–∏ - WhatsApp Service</title>
    <meta name="Description" content="–õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è WhatsApp Service">
    
    <!-- Favicon -->
    <link rel="icon" href="/bootstrap-theme/assets/images/brand-logos/favicon.ico" type="image/x-icon">
    
    <!-- Bootstrap Css -->
    <link id="style" href="/bootstrap-theme/assets/libs/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Style Css -->
    <link href="/bootstrap-theme/assets/css/styles.min.css" rel="stylesheet">
    
    <!-- Icons Css -->
    <link href="/bootstrap-theme/assets/css/icons.css" rel="stylesheet">
    
    <!-- Node Waves Css -->
    <link href="/bootstrap-theme/assets/libs/node-waves/waves.min.css" rel="stylesheet">
    
    <!-- Simplebar Css -->
    <link href="/bootstrap-theme/assets/libs/simplebar/simplebar.min.css" rel="stylesheet">
    
    <!-- –û–±—â–µ–µ –º–µ–Ω—é -->
    <script src="/menu.js"></script>
    
    <!-- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—Ç–∞—Ç—É—Å–∞ WhatsApp -->
    <script src="/whatsapp-status.js"></script>
    
    <!-- Fix for missing DOM elements - MUST be before other scripts -->
    <script>
        // Global error handler to prevent script errors from breaking the page
        window.addEventListener('error', function(e) {
            const errorMessage = e.message || '';
            const errorFilename = e.filename || '';
            
            if (errorMessage.includes('Cannot read properties of null') ||
                errorMessage.includes('classList') ||
                errorMessage.includes('addEventListener') ||
                errorMessage.includes('appendChild') ||
                errorFilename.includes('defaultmenu.min.js') ||
                errorFilename.includes('custom-switcher.min.js') ||
                errorFilename.includes('custom.js')) {
                e.preventDefault();
                e.stopPropagation();
                return true;
            }
        }, true);
        
        // Ensure all required DOM elements exist before scripts execute
        (function() {
            let isEnsuring = false;
            
            window.ensureElements = function ensureElements() {
                if (isEnsuring) return;
                isEnsuring = true;
                
                try {
                    if (!document.getElementById('loader')) {
                        const loader = document.createElement('div');
                        loader.id = 'loader';
                        loader.innerHTML = '<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>';
                        loader.style.display = 'none';
                        document.body.appendChild(loader);
                    }
                    
                    if (!document.querySelector('.horizontal-menu')) {
                        const headerContainer = document.querySelector('.main-header-container');
                        if (headerContainer) {
                            const headerCenter = document.createElement('div');
                            headerCenter.className = 'main-header-center d-none d-lg-block';
                            headerCenter.style.display = 'none';
                            const horizontalMenu = document.createElement('nav');
                            horizontalMenu.className = 'horizontal-menu';
                            const ul = document.createElement('ul');
                            ul.className = 'horizontal-list';
                            horizontalMenu.appendChild(ul);
                            headerCenter.appendChild(horizontalMenu);
                            headerContainer.appendChild(headerCenter);
                        }
                    }
                    
                    if (!document.getElementById('switcher-canvas')) {
                        const switcher = document.createElement('div');
                        switcher.className = 'offcanvas offcanvas-end';
                        switcher.id = 'switcher-canvas';
                        switcher.setAttribute('tabindex', '-1');
                        switcher.setAttribute('aria-labelledby', 'offcanvasRightLabel');
                        switcher.innerHTML = '<div class="offcanvas-header border-bottom"><h5 class="offcanvas-title text-default" id="offcanvasRightLabel">Switcher</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button></div><div class="offcanvas-body"></div>';
                        document.body.appendChild(switcher);
                    }
                    
                    if (!document.getElementById('header-sidebar')) {
                        const headerSidebar = document.createElement('div');
                        headerSidebar.className = 'offcanvas offcanvas-end';
                        headerSidebar.id = 'header-sidebar';
                        headerSidebar.setAttribute('tabindex', '-1');
                        headerSidebar.setAttribute('aria-labelledby', 'sidebarLabel');
                        headerSidebar.innerHTML = '<div class="offcanvas-header rounded-0"><h5 class="fs-14 text-uppercase mb-0 fw-semibold" id="sidebarLabel">–ú–µ–Ω—é</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button></div><div class="offcanvas-body rounded-0 p-0"></div>';
                        document.body.appendChild(headerSidebar);
                    }
                    
                    if (!document.querySelector('.scrollToTop')) {
                        const scrollToTop = document.createElement('div');
                        scrollToTop.className = 'scrollToTop';
                        scrollToTop.innerHTML = '<span class="arrow"><i class="las la-angle-double-up"></i></span>';
                        document.body.appendChild(scrollToTop);
                    }
                    
                    if (!document.getElementById('responsive-overlay')) {
                        const overlay = document.createElement('div');
                        overlay.id = 'responsive-overlay';
                        document.body.appendChild(overlay);
                    }
                    
                    const loader = document.getElementById('loader');
                    if (loader) {
                        loader.style.display = 'none';
                    }
                } catch (e) {
                    console.warn('Error in ensureElements:', e);
                } finally {
                    isEnsuring = false;
                }
            };
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    window.ensureElements();
                    setTimeout(window.ensureElements, 100);
                });
            } else {
                window.ensureElements();
                setTimeout(window.ensureElements, 100);
            }
        })();
    </script>
    
    <style>
        .app-sidebar {
            display: block !important;
            visibility: visible !important;
        }
        .main-menu {
            display: block !important;
        }
        .side-menu__item {
            display: flex !important;
            align-items: center !important;
            padding: 0.75rem 1.25rem !important;
            color: #495057 !important;
            text-decoration: none !important;
        }
        .side-menu__item:hover {
            background-color: #f8f9fa !important;
        }
        .side-menu__item.active {
            background-color: #e7f1ff !important;
            color: #0d6efd !important;
        }
        .side-menu__icon {
            width: 20px;
            height: 20px;
            margin-right: 0.75rem;
            fill: currentColor;
        }
        .side-menu__label {
            display: block !important;
        }
        .logs-container {
            height: 600px;
            overflow-y: auto;
            background-color: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            padding: 15px;
            border-radius: 8px;
        }
        .log-entry {
            margin-bottom: 5px;
            padding: 3px 0;
            border-bottom: 1px solid #2d2d2d;
        }
        .log-entry:last-child {
            border-bottom: none;
        }
        .log-timestamp {
            color: #858585;
            margin-right: 10px;
        }
        .log-level-info { color: #4ec9b0; }
        .log-level-warn { color: #dcdcaa; }
        .log-level-error { color: #f48771; }
        .log-level-debug { color: #569cd6; }
        .log-message { color: #d4d4d4; word-wrap: break-word; }
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>

<body>
    <!-- Page Loader -->
    <div id="loader" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
    <!-- Page Loader -->

    <!-- Start Switcher -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="switcher-canvas" aria-labelledby="offcanvasRightLabel">
        <div class="offcanvas-header border-bottom">
            <h5 class="offcanvas-title text-default" id="offcanvasRightLabel">Switcher</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <p>Switcher content</p>
        </div>
    </div>
    <!-- End Switcher -->
    
    <div class="page">
        <!-- app-header -->
        <header class="app-header">
            <div class="main-header-container container-fluid">
                <div class="header-content-left">
                    <div class="header-element">
                        <a aria-label="Toggle Sidebar" class="sidemenu-toggle header-link animated-arrow hor-toggle horizontal-navtoggle" data-bs-toggle="sidebar" href="javascript:void(0);">
                            <i class="header-icon fe fe-align-left"></i>
                        </a>
                        <div class="main-header-center d-none d-lg-block" style="display: none !important;">
                            <nav class="horizontal-menu">
                                <ul class="horizontal-list"></ul>
                            </nav>
                        </div>
                    </div>
                    <div class="header-element">
                        <div class="horizontal-logo">
                            <a href="/" class="header-logo">
                                <span class="desktop-logo">üì± WhatsApp Service</span>
                                <span class="toggle-logo">WhatsApp</span>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="header-content-right">
                    <div class="header-element">
                        <span class="badge bg-success" id="serviceStatusBadge">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                    </div>
                </div>
            </div>
        </header>
        <!-- /app-header -->

        <!-- Start::app-sidebar -->
        <aside class="app-sidebar sticky" id="sidebar">
            <div class="main-sidebar-header">
                <a href="/" class="header-logo">
                    <span class="desktop-logo">üì± WhatsApp</span>
                    <span class="toggle-logo">WA</span>
                </a>
            </div>
            <div class="main-sidebar" id="sidebar-scroll">
                <nav class="main-menu-container nav nav-pills flex-column sub-open">
                    <div class="slide-left" id="slide-left">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="#7b8191" width="24" height="24" viewBox="0 0 24 24"> <path d="M13.293 6.293 7.586 12l5.707 5.707 1.414-1.414L10.414 12l4.293-4.293z"></path> </svg>
                    </div>
                    <ul class="main-menu" id="main-menu">
                        <li class="slide">
                            <a href="/" class="side-menu__item">
                                <svg xmlns="http://www.w3.org/2000/svg" class="side-menu__icon" viewBox="0 0 24 24">
                                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                                </svg>
                                <span class="side-menu__label">–ì–ª–∞–≤–Ω–∞—è</span>
                            </a>
                        </li>
                        <li class="slide">
                            <a href="/messages" class="side-menu__item">
                                <svg xmlns="http://www.w3.org/2000/svg" class="side-menu__icon" viewBox="0 0 24 24">
                                    <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                                </svg>
                                <span class="side-menu__label">–°–æ–æ–±—â–µ–Ω–∏—è</span>
                            </a>
                        </li>
                        <li class="slide">
                            <a href="/chats" class="side-menu__item">
                                <svg xmlns="http://www.w3.org/2000/svg" class="side-menu__icon" viewBox="0 0 24 24">
                                    <path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H6l-2-2V6h16v12z"/>
                                </svg>
                                <span class="side-menu__label">–ß–∞—Ç—ã</span>
                            </a>
                        </li>
                        <li class="slide">
                            <a href="/settings" class="side-menu__item">
                                <svg xmlns="http://www.w3.org/2000/svg" class="side-menu__icon" viewBox="0 0 24 24">
                                    <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                                </svg>
                                <span class="side-menu__label">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                            </a>
                        </li>
                        <li class="slide">
                            <a href="/logs" class="side-menu__item active">
                                <svg xmlns="http://www.w3.org/2000/svg" class="side-menu__icon" viewBox="0 0 24 24">
                                    <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0L19.2 12l-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>
                                </svg>
                                <span class="side-menu__label">–õ–æ–≥–∏</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </aside>
        <!-- End::app-sidebar -->

        <!--APP-CONTENT START-->
        <div class="main-content app-content">
            <div class="container-fluid">
                <div class="d-md-flex d-block align-items-center justify-content-between my-4 page-header-breadcrumb">
                    <div class="my-auto">
                        <h5 class="page-title fs-21 mb-1">–õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h5>
                        <nav>
                            <ol class="breadcrumb mb-0">
                                <li class="breadcrumb-item"><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                                <li class="breadcrumb-item active" aria-current="page">–õ–æ–≥–∏</li>
                            </ol>
                        </nav>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-xl-12">
                        <div class="card custom-card">
                            <div class="card-header justify-content-between">
                                <div class="card-title">
                                    <i class="fe fe-terminal me-2"></i>–õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-outline-danger me-2" onclick="clearLogs()">
                                        <i class="fe fe-trash-2 me-1"></i> –û—á–∏—Å—Ç–∏—Ç—å
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="refreshLogs()">
                                        <i class="fe fe-refresh-cw me-1"></i> –û–±–Ω–æ–≤–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div id="logsContainer" class="logs-container">
                                    <div class="text-center text-muted p-3">
                                        <span class="loading"></span> –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ (—Ç–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è) -->
                <div class="row">
                    <div class="col-xl-12">
                        <div class="card custom-card">
                            <div class="card-header justify-content-between">
                                <div class="card-title">
                                    <i class="fe fe-cpu me-2"></i>–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ (—Ç–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è)
                                </div>
                                <div>
                                    <span class="badge bg-primary me-2" id="productsCount">0</span>
                                    <button class="btn btn-sm btn-outline-danger me-2" onclick="clearProducts()">
                                        <i class="fe fe-trash-2 me-1"></i> –û—á–∏—Å—Ç–∏—Ç—å
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="refreshProducts()">
                                        <i class="fe fe-refresh-cw me-1"></i> –û–±–Ω–æ–≤–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                    <table class="table table-striped table-hover mb-0">
                                        <thead class="table-dark sticky-top">
                                            <tr>
                                                <th>–ú–æ–¥–µ–ª—å</th>
                                                <th>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</th>
                                                <th>–•—ç—à—Ä–µ–π—Ç</th>
                                                <th>–¶–µ–Ω–∞</th>
                                                <th>–õ–æ–∫–∞—Ü–∏—è</th>
                                                <th>–í—Ä–µ–º—è</th>
                                            </tr>
                                        </thead>
                                        <tbody id="productsTableBody">
                                            <tr>
                                                <td colspan="6" class="text-center text-muted p-3">
                                                    <span class="loading"></span> –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è...
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
                <div class="row">
                    <div class="col-xl-12">
                        <div class="card custom-card border-warning">
                            <div class="card-header bg-warning-transparent">
                                <div class="card-title">
                                    <i class="fe fe-send me-2"></i>–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                                </div>
                            </div>
                            <div class="card-body">
                                <p class="text-muted small mb-3">
                                    –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏. –°–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∫–∞–∫ –±—É–¥—Ç–æ –æ–Ω–æ –ø—Ä–∏—à–ª–æ –∏–∑ –≥—Ä—É–ø–ø—ã WhatsApp.
                                </p>
                                <form id="testMessageForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="testChatName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞</label>
                                            <input type="text" class="form-control" id="testChatName" 
                                                   placeholder="Test Group" value="Test Group">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="testSenderName" class="form-label">–ò–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è</label>
                                            <input type="text" class="form-control" id="testSenderName" 
                                                   placeholder="Test User" value="Test User">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="testSenderPhone" class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è</label>
                                            <input type="text" class="form-control" id="testSenderPhone" 
                                                   placeholder="79999999999" value="79999999999">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">–¢–∏–ø —á–∞—Ç–∞</label>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="testIsGroup" 
                                                       id="testIsGroup" value="true" checked>
                                                <label class="form-check-label" for="testIsGroup">
                                                    –ì—Ä—É–ø–ø–∞
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="testIsGroup" 
                                                       id="testIsPersonal" value="false">
                                                <label class="form-check-label" for="testIsPersonal">
                                                    –õ–∏—á–Ω—ã–π —á–∞—Ç
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="testPromptId" class="form-label">–ü—Ä–æ–º–ø—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏</label>
                                        <select class="form-select" id="testPromptId">
                                            <option value="">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤...</option>
                                        </select>
                                        <small class="form-text text-muted">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–º–ø—Ç –∏–∑ Ollama Service –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</small>
                                    </div>
                                    <div class="mb-3">
                                        <label for="testMessageContent" class="form-label">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</label>
                                        <textarea class="form-control" id="testMessageContent" rows="5" 
                                                  placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä:&#10;–ü—Ä–æ–¥–∞–º –ú–æ—Å–∫–≤–∞ –ë/–£:&#10;1)S19j PRO 104T, 1—à—Ç. 270u;&#10;2)S19j XP 143T, 43—à—Ç. –ø–æ 900u;" required></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-warning">
                                        <i class="fe fe-send me-1"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Start -->
        <footer class="footer mt-auto py-4 bg-white">
            <div class="container-fluid">
                <div class="text-center">
                    <span class="text-muted">WhatsApp Service &copy; 2025</span>
                </div>
            </div>
        </footer>
        <!-- Footer End -->
    </div>

    <!-- Scroll To Top -->
    <div class="scrollToTop">
        <span class="arrow"><i class="las la-angle-double-up"></i></span>
    </div>
    <div id="responsive-overlay"></div>
    <!-- Scroll To Top -->

    <!-- Popper JS -->
    <script src="/bootstrap-theme/assets/libs/@popperjs/core/umd/popper.min.js"></script>
    <script src="/bootstrap-theme/assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/bootstrap-theme/assets/libs/node-waves/waves.min.js"></script>
    <script src="/bootstrap-theme/assets/libs/simplebar/simplebar.min.js"></script>
    <!-- Custom JS –¥–ª—è —Ä–∞–±–æ—Ç—ã –º–µ–Ω—é -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof window.ensureElements === 'function') {
                window.ensureElements();
                setTimeout(window.ensureElements, 200);
                setTimeout(window.ensureElements, 500);
            }
            
            setTimeout(function() {
                const scripts = [
                    '/bootstrap-theme/assets/js/defaultmenu.min.js',
                    '/bootstrap-theme/assets/js/custom-switcher.min.js',
                    '/bootstrap-theme/assets/js/custom.js'
                ];
                
                scripts.forEach(function(src) {
                    const script = document.createElement('script');
                    script.src = src;
                    script.onerror = function() {};
                    document.body.appendChild(script);
                });
            }, 300);
        });
        
        let isScrolledToBottom = true;
        
        function checkIfScrolledToBottom() {
            const container = document.getElementById('logsContainer');
            if (!container) return true;
            return container.scrollHeight - container.scrollTop <= container.clientHeight + 10;
        }
        
        async function refreshLogs() {
            try {
                const response = await fetch('/api/logs');
                const data = await response.json();
                
                const container = document.getElementById('logsContainer');
                if (!container) return;
                
                const wasScrolledToBottom = checkIfScrolledToBottom();
                
                if (data.logs && data.logs.length > 0) {
                    container.innerHTML = data.logs.map(log => {
                        const levelClass = `log-level-${log.level || 'info'}`;
                        return `
                            <div class="log-entry">
                                <span class="log-timestamp">[${log.timestamp || ''}]</span>
                                <span class="${levelClass}">[${(log.level || 'INFO').toUpperCase()}]</span>
                                <span class="log-message">${escapeHtml(log.message || '')}</span>
                            </div>
                        `;
                    }).join('');
                    
                    if (wasScrolledToBottom || isScrolledToBottom) {
                        container.scrollTop = container.scrollHeight;
                    }
                } else {
                    container.innerHTML = '<div class="text-center text-muted p-3">–õ–æ–≥–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</div>';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤:', error);
            }
        }
        
        async function clearLogs() {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏?')) {
                return;
            }
            
            try {
                const response = await fetch('/api/logs/clear', { method: 'POST' });
                if (response.ok) {
                    refreshLogs();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –ª–æ–≥–æ–≤:', error);
            }
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º
        async function refreshProducts() {
            try {
                const response = await fetch('/api/products');
                
                if (!response.ok) {
                    const tableBody = document.getElementById('productsTableBody');
                    if (tableBody) {
                        tableBody.innerHTML = `<tr><td colspan="6" class="text-center text-danger p-3">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}</td></tr>`;
                    }
                    return;
                }
                
                const data = await response.json();
                // API –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ª–∏–±–æ –º–∞—Å—Å–∏–≤, –ª–∏–±–æ –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª–µ–º products
                const products = Array.isArray(data) ? data : (data.products || []);
                
                const tableBody = document.getElementById('productsTableBody');
                const productsCount = document.getElementById('productsCount');
                
                if (!tableBody) return;
                
                if (productsCount) {
                    productsCount.textContent = products.length;
                }
                
                if (products.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="text-center text-muted p-3">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</td></tr>';
                    return;
                }
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ timestamp (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–µ—Ä–≤—ã–º–∏)
                const sortedProducts = [...products].sort((a, b) => {
                    const timeA = a.timestamp ? new Date(a.timestamp).getTime() : 0;
                    const timeB = b.timestamp ? new Date(b.timestamp).getTime() : 0;
                    return timeB - timeA; // –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–µ—Ä–≤—ã–º–∏
                });
                
                tableBody.innerHTML = sortedProducts.map(product => {
                    const price = product.price 
                        ? `${product.price} ${product.currency || ''}`.trim()
                        : '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
                    const time = product.timestamp 
                        ? new Date(product.timestamp).toLocaleString('ru-RU', { 
                            year: 'numeric', 
                            month: '2-digit', 
                            day: '2-digit',
                            hour: '2-digit', 
                            minute: '2-digit', 
                            second: '2-digit' 
                          })
                        : '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                    
                    return `
                        <tr>
                            <td><strong>${escapeHtml(product.model || '–ù–µ —É–∫–∞–∑–∞–Ω–∞')}</strong></td>
                            <td>${escapeHtml(product.manufacturer || '–ù–µ —É–∫–∞–∑–∞–Ω')}</td>
                            <td><code>${escapeHtml(product.hashrate || '–ù–µ —É–∫–∞–∑–∞–Ω')}</code></td>
                            <td>${escapeHtml(price)}</td>
                            <td>${escapeHtml(product.location || '–ù–µ —É–∫–∞–∑–∞–Ω–∞')}</td>
                            <td class="text-muted small">${escapeHtml(time)}</td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è:', error);
                const tableBody = document.getElementById('productsTableBody');
                if (tableBody) {
                    tableBody.innerHTML = `<tr><td colspan="6" class="text-center text-danger p-3">–û—à–∏–±–∫–∞: ${escapeHtml(error.message)}</td></tr>`;
                }
            }
        }
        
        async function clearProducts() {
            if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è?')) {
                return;
            }
            
            try {
                const response = await fetch('/api/products/clear', {
                    method: 'POST'
                });
                
                if (response.ok) {
                    refreshProducts();
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è: ' + error.message);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏
        let OLLAMA_SERVICE_URL = 'http://localhost:4000';
        let availablePrompts = [];
        let selectedPromptId = null;
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º URL Ollama Service –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        async function loadOllamaServiceUrl() {
            try {
                const response = await fetch('/api/ollama-service-url');
                if (response.ok) {
                    const data = await response.json();
                    OLLAMA_SERVICE_URL = data.url || 'http://localhost:4000';
                    console.log(`‚úÖ URL Ollama Service: ${OLLAMA_SERVICE_URL}`);
                } else {
                    console.warn(`‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å URL Ollama Service (HTTP ${response.status}), –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: ${OLLAMA_SERVICE_URL}`);
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å URL Ollama Service, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:', error.message);
            }
        }
        
        async function loadPrompts() {
            try {
                const select = document.getElementById('testPromptId');
                if (!select) return;
                
                select.innerHTML = '<option value="">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤...</option>';
                select.disabled = true;
                
                console.log(`üì° –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏–∑ ${OLLAMA_SERVICE_URL}/api/prompts...`);
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º AbortController –¥–ª—è —Ç–∞–π–º–∞—É—Ç–∞
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);
                
                const response = await fetch(`${OLLAMA_SERVICE_URL}/api/prompts`, {
                    signal: controller.signal
                }).catch(error => {
                    clearTimeout(timeoutId);
                    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                    if (error.name === 'AbortError') {
                        throw new Error(`–¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Ollama Service (${OLLAMA_SERVICE_URL})`);
                    } else if (error.name === 'TypeError' && (error.message.includes('Failed to fetch') || error.message.includes('ERR_CONNECTION_REFUSED'))) {
                        throw new Error(`Ollama Service –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É ${OLLAMA_SERVICE_URL}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ Ollama Service –Ω–∞ –ø–æ—Ä—Ç—É 4000.`);
                    }
                    throw error;
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    if (response.status === 0 || response.status >= 500) {
                        throw new Error(`Ollama Service –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (HTTP ${response.status})`);
                    }
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const prompts = await response.json();
                availablePrompts = Array.isArray(prompts) ? prompts : [];
                
                if (availablePrompts.length === 0) {
                    select.innerHTML = '<option value="">–ü—Ä–æ–º–ø—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ Ollama Service</option>';
                    select.disabled = true;
                    console.warn('‚ö†Ô∏è  –ü—Ä–æ–º–ø—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ Ollama Service');
                    return;
                }
                
                select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–º–ø—Ç --</option>';
                availablePrompts.forEach(prompt => {
                    const option = document.createElement('option');
                    option.value = prompt.id;
                    option.textContent = `${prompt.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'} (ID: ${prompt.id})`;
                    if (prompt.description) {
                        option.title = prompt.description;
                    }
                    select.appendChild(option);
                });
                
                select.disabled = false;
                console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${availablePrompts.length} –ø—Ä–æ–º–ø—Ç–æ–≤ –∏–∑ Ollama Service`);
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∏–∑ localStorage
                const savedPromptId = localStorage.getItem('selectedPromptId');
                if (savedPromptId) {
                    const promptExists = availablePrompts.some(p => p.id == savedPromptId);
                    if (promptExists) {
                        select.value = savedPromptId;
                        selectedPromptId = parseInt(savedPromptId);
                        console.log(`‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç ID: ${selectedPromptId}`);
                    }
                } else if (availablePrompts.length > 0) {
                    // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ, –≤—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π –ø—Ä–æ–º–ø—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    select.value = availablePrompts[0].id;
                    selectedPromptId = availablePrompts[0].id;
                    localStorage.setItem('selectedPromptId', selectedPromptId);
                    console.log(`‚úÖ –í—ã–±—Ä–∞–Ω –ø—Ä–æ–º–ø—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ID: ${selectedPromptId}`);
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤:', error);
                const select = document.getElementById('testPromptId');
                if (select) {
                    let errorMessage = error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
                    if (errorMessage.includes('Failed to fetch') || errorMessage.includes('ERR_CONNECTION_REFUSED')) {
                        errorMessage = `Ollama Service –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É ${OLLAMA_SERVICE_URL}. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Ollama Service –∑–∞–ø—É—â–µ–Ω.`;
                    }
                    select.innerHTML = `<option value="">‚ö†Ô∏è ${escapeHtml(errorMessage)}</option>`;
                    select.disabled = false; // –†–∞–∑—Ä–µ—à–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ—Ä–º—É, –Ω–æ –±–µ–∑ –ø—Ä–æ–º–ø—Ç–∞
                    select.title = '–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –¥–ª—è —Ä–∞–±–æ—Ç—ã —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º Ollama Service';
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
        document.addEventListener('DOMContentLoaded', () => {
            const promptSelect = document.getElementById('testPromptId');
            if (promptSelect) {
                promptSelect.addEventListener('change', (e) => {
                    selectedPromptId = e.target.value ? parseInt(e.target.value) : null;
                    if (selectedPromptId) {
                        localStorage.setItem('selectedPromptId', selectedPromptId);
                    } else {
                        localStorage.removeItem('selectedPromptId');
                    }
                });
            }
        });
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
        async function sendTestMessage(event) {
            if (event) {
                event.preventDefault();
            }
            
            console.log('üì§ –ù–∞—á–∞–ª–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è...');
            
            // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
            const contentElement = document.getElementById('testMessageContent');
            const chatNameElement = document.getElementById('testChatName');
            const senderNameElement = document.getElementById('testSenderName');
            const senderPhoneElement = document.getElementById('testSenderPhone');
            const promptIdElement = document.getElementById('testPromptId');
            
            console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:');
            console.log('  - contentElement:', contentElement);
            console.log('  - chatNameElement:', chatNameElement);
            
            if (!contentElement) {
                alert('–û—à–∏–±–∫–∞: –ø–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!');
                console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç testMessageContent –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }
            
            const content = contentElement.value.trim();
            const chatName = chatNameElement?.value.trim() || 'Test Group';
            const senderName = senderNameElement?.value.trim() || 'Test User';
            const senderPhone = senderPhoneElement?.value.trim() || '79999999999';
            const isGroup = document.querySelector('input[name="testIsGroup"]:checked')?.value === 'true';
            const promptId = promptIdElement?.value ? parseInt(promptIdElement.value) : null;
            
            console.log('üìù –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã:');
            console.log('  - content (–¥–ª–∏–Ω–∞):', content.length, '| –∑–Ω–∞—á–µ–Ω–∏–µ:', content);
            console.log('  - chatName:', chatName);
            console.log('  - senderName:', senderName);
            console.log('  - senderPhone:', senderPhone);
            console.log('  - isGroup:', isGroup);
            console.log('  - promptId:', promptId);
            
            if (!content || content.length === 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è');
                console.error('‚ùå –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø—É—Å—Ç–æ–π!');
                return;
            }
            
            // –ü—Ä–æ–º–ø—Ç –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –Ω–æ –µ—Å–ª–∏ –µ—Å—Ç—å - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
            if (!promptId && availablePrompts.length > 0) {
                const useDefault = confirm('–ü—Ä–æ–º–ø—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞ (–±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø—Ä–æ–º–ø—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)?');
                if (!useDefault) {
                    return;
                }
            }
            
            const form = document.getElementById('testMessageForm');
            const submitButton = form?.querySelector('button[type="submit"]');
            const originalText = submitButton?.innerHTML || '–û—Ç–ø—Ä–∞–≤–∏—Ç—å';
            
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.innerHTML = '<span class="loading"></span> –û—Ç–ø—Ä–∞–≤–∫–∞...';
            }
            
            try {
                const requestBody = {
                    content: content,
                    chatName: chatName,
                    senderName: senderName,
                    senderPhone: senderPhone,
                    isGroup: isGroup,
                    promptId: promptId
                };
                
                console.log('üì¶ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', requestBody);
                
                const response = await fetch('/api/test-message', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                console.log('üì• –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç:', response.status, response.statusText);
                
                const data = await response.json();
                console.log('üì• –î–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞:', data);
                
                if (response.ok && data.success) {
                    alert('–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ!');
                    
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    if (contentElement) {
                        contentElement.value = '';
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–≥–∏ –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
                    setTimeout(() => {
                        refreshLogs();
                        refreshProducts();
                    }, 1000);
                } else {
                    const errorMsg = data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
                    alert(`–û—à–∏–±–∫–∞: ${errorMsg}`);
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:', errorMsg);
                }
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ${error.message}`);
                console.error('‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:', error);
            } finally {
                if (submitButton) {
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalText;
                }
            }
        }
        
        document.addEventListener('DOMContentLoaded', async () => {
            refreshLogs();
            refreshProducts();
            await loadOllamaServiceUrl();
            await loadPrompts();
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ
            // setInterval(refreshLogs, 2000);
            // setInterval(refreshProducts, 3000);
            
            const container = document.getElementById('logsContainer');
            if (container) {
                container.addEventListener('scroll', () => {
                    isScrolledToBottom = checkIfScrolledToBottom();
                });
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
            const testMessageForm = document.getElementById('testMessageForm');
            if (testMessageForm) {
                testMessageForm.addEventListener('submit', sendTestMessage);
            }
        });
    </script>
</body>

</html>
