# Запуск WhatsApp Сервиса

## Автоматический запуск

Для запуска WhatsApp сервиса используйте один из bat-файлов:

### Вариант 1: Простой запуск
Дважды кликните на файл:
```
start.bat
```

### Вариант 2: Перезапуск (остановка старых процессов и запуск)
Дважды кликните на файл:
```
restart-whatsapp.bat
```

## Ручной запуск через командную строку (CMD)

1. Откройте **CMD** (не PowerShell!)
2. Перейдите в директорию WhatsApp сервиса:
```cmd
cd C:\IdeaPRG\miners\whatsapp-service
```

3. Остановите существующие процессы (если есть):
```cmd
taskkill /F /IM node.exe
```

4. Установите зависимости (если еще не установлены):
```cmd
npm install
```

5. Запустите сервис:
```cmd
npm start
```

## Проверка работы

После запуска:

1. **Веб-интерфейс**: Откройте в браузере http://localhost:3000
   - Там вы увидите статус подключения
   - QR-код для подключения WhatsApp (если требуется)
   - Список групп для мониторинга

2. **Логи**: Проверьте логи в папке `logs/`:
   - `combined.log` - все логи
   - `error.log` - только ошибки

3. **Статус подключения**: 
   - В консоли или веб-интерфейсе проверьте статус:
     - `disconnected` - не подключен
     - `connecting` - подключение (нужен QR-код)
     - `connected` - подключен
     - `ready` - готов к работе

## Требования

1. **Node.js** должен быть установлен (версия 18+)
2. **Spring Boot приложение** должно быть запущено на порту 8080
3. **Интернет** должен быть доступен для подключения к WhatsApp Web

## Возможные проблемы

### Ошибка: "Node.js is not installed"
- Установите Node.js с https://nodejs.org/
- Перезагрузите компьютер после установки

### Ошибка: "Port 3000 is already in use"
- Остановите существующие процессы Node.js:
  ```cmd
  taskkill /F /IM node.exe
  ```

### Ошибка подключения к Spring Boot API
- Убедитесь, что Spring Boot приложение запущено на порту 8080
- Проверьте URL в `config.js` или `.env`

### Ошибка: "ProtocolError: Target closed"
- Это означает, что браузер Puppeteer закрылся
- Перезапустите WhatsApp сервис

### WhatsApp требует QR-код каждый раз
- Сессия сохраняется в папке `.wwebjs_auth`
- Если папка повреждена, удалите ее и переподключитесь

## Конфигурация

Настройки можно изменить в файлах:
- `config.js` - основные настройки
- `.env` - переменные окружения (если есть)
- `monitoring-config.json` - группы для мониторинга (можно настроить через веб-интерфейс)


